---
title: "Two-Way ANOVA"
author: "James Van Slyke"
---

```{r setup, include=FALSE}
library(tidyverse)
```

## Two-Way ANOVA

*Before starting this section please review the section One-Way ANOVA first*

### Revisiting One-Way ANOVA

One-way ANOVA is based on the general idea that the total variability $SS_T$ is partitioned (divided or separated) into two types of variability. The variability between the groups $SS_{between}$ and the variability within the groups $SS_{within}$. Remember that the variability between the groups needed to be *greater* than the variability within the groups because that would indicate that the difference between the groups was greater than the measurement error that existed within the groups.

#### Main Effects

Two-way ANOVA goes beyond one-way ANOVA by analyzing the effects of two independent variables in the same experiment. In a two-way ANOVA the two independent variables are called *main effects* or *factors* and each main effect has its own individual hypothesis.

#### Interaction effects

Finally, the two-way ANOVA analyzes if there is an *interaction effect* between the two main effects or factors. An interaction effect occurs when the effect of one of the independent variables is not the same at all levels of the second independent variable. So the set up for a two-way ANOVA is:

-   Independent variable 1 = Main effect 1 = Factor 1

-   Independent variable 2 = Main effect 2 = Factor 2

-   Interaction effect = Interaction between Factors 1 & 2

#### Two-Way ANOVA Example

The example dataset tests what's called the "beer googles effect". Sometimes alcohol can have an effect on perceptions of attraction for potential dates, especially later in the evening at bars. The dataset tests whether perceptions of attractiveness change after drinking alcohol and whether males and females are effected by this phenomenon differently.

##### Variables

Two Independent Variables (Main Effects or Factors)

-   Main Effect 1 = Alcohol 3 Levels (None, 2 Pints, 4 Pints)
-   Main Effect 2 = Gender 2 Levels (Male and Female)
-   Interaction Effect = Gender x Alcohol
-   DV = Attractiveness of the partner selected at the end of the evening

Alternative Hypotheses

-   $H_1$ Alcohol has an effect on the attractiveness level of the selected partner
-   $H_2$ Gender has an effect on the attractiveness level of the partner.
-   $H_3$ There is an interaction effect between Alcohol and Gender

Sum of Squares variation estimates

### Fixing the Variables

Get the dataset and import it

```{r, eval=TRUE}
library(haven)
goggles <- read_sav("goggles.sav")
```

Check out Gender variable

```{r, eval=TRUE}
goggles$Gender
```

Check out Alcohol variable

```{r, eval=TRUE}
goggles$Alcohol
```

Check out Attractiveness variable

```{r, eval=TRUE}
goggles$Attractiveness
```

Alcohol and Gender variables are factors. When they get imported from SPSS they don't function as well because the focus is on the numbers, not the labels or words.We can use tidyverse and the mutate function to fix this.

```{r, eval=TRUE}
goggles <- goggles %>% 
  mutate(Gender = factor(Gender, levels = c(0,1), 
         labels = c("Male", "Female")))
```

We can do the same thing with the Alcohol variable. Make sure you know the levels or numbering of the variable

```{r, eval=TRUE}
goggles$Alcohol
```

Then go ahead and mutate the variable as you did with Gender

```{r, eval=TRUE}
goggles <- goggles %>% 
  mutate(Alcohol = factor(Alcohol, levels = c(1,2,3), 
            labels = c("None", "2 Pints", "4 Pints")))
```

#### Running Two-Way ANOVA in R Studio

Now we can move to the Two-Way ANOVA analysis. "m3" is the new object to save results so the formula will have this structure.

> \# m3 \<- aov (this is the computation you are using, like t.test) Then the rest of your formula should look like this (Dependent variable \~ Varible 1 + Variable 2 + Variable 1\*Variable 2, data = \[your dataset\])

```{r, eval=TRUE}
m3 <- aov(Attractiveness ~ Gender + Alcohol + 
           Gender*Alcohol, data = goggles)
```

Check the results

```{r}
summary(m3)
```

Key Findings from our output\
Main effect of Alcohol on attractiveness\
Interaction effect of Alcohol and Gender\
*What does this mean?*

### Graphs for the Main Effects

Let's use a graph to understand this better\
First let's look at each variable individually

```{r, eval=TRUE}
GogglesAlcohol <- goggles %>%
  group_by(Alcohol) %>%
  summarize(n = n(),
            mean = mean(Attractiveness),
            sd = sd(Attractiveness),
            se = sd/sqrt(n),
            ci = qt(0.975, df = n - 1) * sd / sqrt(n))
```

Graph the Alcohol variable individually

```{r, eval=TRUE}
ggplot(GogglesAlcohol, aes(x = Alcohol,
                                y = mean)) +
  geom_point(size = 3) +
  geom_line(size = 1) +
  geom_errorbar(aes(ymin  =mean - ci, 
                    ymax = mean + ci), 
                width = .1)
```

Graph the Gender variable individually

```{r, eval=TRUE}
GogglesGender <- goggles %>%
  group_by(Gender) %>%
  summarize(n = n(),
            mean = mean(Attractiveness),
            sd = sd(Attractiveness),
            se = sd/sqrt(n),
            ci = qt(0.975, df = n - 1) * sd / sqrt(n))
```

Graph it

```{r, eval=TRUE}
ggplot(GogglesGender, aes(x = Gender,
                           y = mean)) +
  geom_point(size = 3) +
  geom_line(size = 1) +
  geom_errorbar(aes(ymin  =mean - ci, 
                    ymax = mean + ci), 
                width = .1) +
  ylim(0,70)
```

Graph the Interaction Effect

Finally, we can graph relationships for both variables.\
First find your descriptive statistics, but this time based on two independent variables

```{r, eval=TRUE}
GogglesDescriptives <- goggles %>%
  group_by(Alcohol, Gender) %>%
  summarize(n = n(),
            mean = mean(Attractiveness),
            sd = sd(Attractiveness),
            se = sd/sqrt(n),
            ci = qt(0.975, df = n - 1) * sd / sqrt(n))
```

Check it

```{r, eval=TRUE}
GogglesDescriptives
```

Use a line graph to graph the relationship

```{r, eval=TRUE}
ggplot(GogglesDescriptives, aes(x = Alcohol,
                     y = mean, 
                     group=Gender, 
                     color=Gender)) +
  geom_point(size = 3) +
  geom_line(size = 1) +
  geom_errorbar(aes(ymin  =mean - ci, 
                    ymax = mean + ci), 
                width = .1)
```

Use dodge functions to make graph clearer

```{r, eval=TRUE}
pd <- position_dodge(0.2)
ggplot(GogglesDescriptives, 
       aes(x = Alcohol, 
           y = mean, 
           group=Gender, 
           color=Gender)) +
  geom_point(position = pd, 
             size = 3) +
  geom_line(position = pd,
            size = 1) +
  geom_errorbar(aes(ymin = mean - ci, 
                    ymax = mean + ci), 
                width = .1, 
                position= pd)
```

All the bells and whistles

```{r, eval=TRUE}
pd <- position_dodge(0.2)
ggplot(GogglesDescriptives, 
       aes(x = Alcohol, 
           y = mean, 
           group=Gender, 
           color=Gender)) +
  geom_point(position=pd, 
             size = 3) +
  geom_line(position = pd, 
            size = 1) +
  geom_errorbar(aes(ymin = mean - ci, 
                    ymax = mean + ci), 
                width = .1, 
                position = pd, 
                size = 1) +
  scale_color_brewer(palette="Set1") +
  theme_minimal() +
  labs(title = "Beer Goggels Effect",
       x = "Amount of Alcohol Consumed", 
       y = "Mean Level of Attractiveness",
       color = "Gender")
```

Use Tukey to look at specific differences in the groups you are interested in

```{r, eval=TRUE}
TukeyHSD(m3)
```

For us, the most important difference is that males are more likely to choose a less attractive person at 4 pints of alcohol than females

#### Results Section

##### First write out the main effects

> There was a significant main effect of the amount of alcohol consumed on the attractiveness of the date that was selected, F(2, 42) = 20.07, p \< .001.

> There was not a significant main effect of gender on the attractiveness of the date that was selected, F(1, 42) = 2.03, p = .161.

##### Second, write out the interaction effect

> There was a significant interaction effect between amount of alcohol consumed and gender on the attractiveness of the date that was selected F(2, 42) = 11.91, p \< .001.

##### Third, write out any relevant Tukey findings

> TukeyHSD post hoc tests revealed that at the largest amount of alcohol consumption (4 pints) Males were significantly more likely to choose a less attractive date (M=35.6, SE=3.83) in comparison to females (M=57.5, SE=57.5). This difference, 21.88, 95% CI\[8.27, 35.48\] was significant with an adjusted p = .0003.
